// server/src/templates/weeklySummaryEmail.ts
import { buildBaseEmail } from "./baseEmail";

export const buildWeeklySummaryEmail = (data: {
    displayName?: string;
    avgRisk?: number;
    topCoping?: string;
    streakDays?: number;
    totalSessions?: number;
}) => {
    const name = data.displayName || "there";
    const risk = data.avgRisk !== undefined ? `${Math.round(data.avgRisk * 100)}%` : "N/A";
    const topCoping = data.topCoping || "N/A";
    const streak = data.streakDays ?? 0;
    const sessions = data.totalSessions ?? 0;

    const contentHtml = `
        <p>Hi ${name},</p>
        <p>Here's your TrichMind summary for this week ðŸ’š</p>
        <ul>
            <li>ðŸ“Š <b>Average Relapse Risk:</b> ${risk}</li>
            <li>ðŸ§  <b>Most Used Coping Strategy:</b> ${topCoping}</li>
            <li>ðŸ”¥ <b>Consistency Streak:</b> ${streak} days</li>
            <li>ðŸ“… <b>Weekly Sessions Completed:</b> ${sessions}</li>
        </ul>
        <p>Keep reflecting, keep learning â€” every check-in strengthens your awareness and resilience.</p>
        <p style="text-align:center;">
            <a href="https://trichmind.app/dashboard" class="button">Open Dashboard</a>
        </p>
        <p>See you next week for more insights ðŸŒ¿</p>
    `;

    const html = buildBaseEmail("Your Weekly TrichMind Summary ðŸŒ¼", contentHtml);

    const text = `
        Hi ${name},

        Hereâ€™s your TrichMind summary for this week:

        â€¢ Average Relapse Risk: ${risk}
        â€¢ Most Used Coping Strategy: ${topCoping}
        â€¢ Consistency Streak: ${streak} days
        â€¢ Weekly Sessions Completed: ${sessions}

        Keep going â€” every reflection helps your growth ðŸ’š
        â€” The TrichMind Team
    `;

    return { html, text };
};
